<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Head-to-Head Rankings</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --cream: #FAF8F3;
      --charcoal: #1A1A1A;
      --rust: #C74E3A;
      --sage: #7A9B76;
      --sand: #D4C5B0;
      --shadow: rgba(0, 0, 0, 0.08);
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--cream);
      color: var(--charcoal);
      min-height: 100vh;
      overflow-x: hidden;
    }

    #root {
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 60px 24px;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-family: 'Fraunces', serif;
      font-size: 3.5rem;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 12px;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--charcoal) 0%, var(--rust) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.125rem;
      color: #666;
      margin-bottom: 48px;
      font-weight: 400;
    }

    .phase-indicator {
      display: inline-block;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 700;
      color: var(--rust);
      margin-bottom: 24px;
      padding: 8px 16px;
      background: rgba(199, 78, 58, 0.1);
      border-radius: 20px;
    }

    .input-group {
      margin-bottom: 32px;
      animation: slideIn 0.4s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .input-wrapper {
      display: flex;
      gap: 12px;
    }

    input, textarea {
      flex: 1;
      padding: 16px 20px;
      font-size: 1rem;
      border: 2px solid var(--sand);
      border-radius: 8px;
      background: white;
      font-family: 'DM Sans', sans-serif;
      transition: all 0.2s ease;
    }

    textarea {
      resize: vertical;
      min-height: 120px;
      line-height: 1.6;
    }

    input[type="radio"] {
      width: 18px;
      height: 18px;
      accent-color: var(--rust);
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--rust);
      box-shadow: 0 0 0 3px rgba(199, 78, 58, 0.1);
    }

    button {
      padding: 16px 32px;
      font-size: 1rem;
      font-weight: 600;
      font-family: 'DM Sans', sans-serif;
      background: var(--charcoal);
      color: var(--cream);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px var(--shadow);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: transparent;
      color: var(--charcoal);
      border: 2px solid var(--sand);
    }

    button.secondary:hover {
      background: var(--sand);
      border-color: var(--sand);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .items-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 24px;
      margin-bottom: 32px;
    }

    .item-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: white;
      border: 1px solid var(--sand);
      border-radius: 20px;
      font-size: 0.9375rem;
      animation: popIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes popIn {
      0% { opacity: 0; transform: scale(0.8); }
      100% { opacity: 1; transform: scale(1); }
    }

    .remove-btn {
      padding: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--rust);
      color: white;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .remove-btn:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: none;
    }

    .matchup-container {
      animation: fadeInScale 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .progress-bar {
      height: 4px;
      background: var(--sand);
      border-radius: 4px;
      margin-bottom: 32px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--rust), var(--sage));
      border-radius: 4px;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .matchup-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    .matchup-card {
      background: white;
      border-radius: 16px;
      padding: 48px 32px;
      text-align: center;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      box-shadow: 0 4px 16px var(--shadow);
    }

    .matchup-card:hover {
      transform: translateY(-8px);
      border-color: var(--rust);
      box-shadow: 0 12px 32px rgba(199, 78, 58, 0.15);
    }

    .matchup-card:active {
      transform: translateY(-4px);
    }

    .matchup-card h3 {
      font-family: 'Fraunces', serif;
      font-size: 1.75rem;
      font-weight: 600;
      line-height: 1.3;
      color: var(--charcoal);
    }

    .rankings-list {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 4px 16px var(--shadow);
      margin-bottom: 24px;
    }

    .ranking-item {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px 0;
      border-bottom: 1px solid var(--sand);
      animation: slideInRanking 0.5s ease-out backwards;
    }

    .ranking-item:last-child {
      border-bottom: none;
    }

    @keyframes slideInRanking {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .ranking-number {
      font-family: 'Fraunces', serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--rust);
      min-width: 60px;
      text-align: center;
    }

    .ranking-name {
      flex: 1;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .ranking-score {
      font-family: 'DM Sans', monospace;
      font-size: 1rem;
      color: #666;
      font-weight: 500;
    }

    .trophy {
      display: inline-block;
      margin-left: 8px;
      font-size: 1.5rem;
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 32px;
      flex-wrap: wrap;
    }

    .stats {
      text-align: center;
      font-size: 0.9375rem;
      color: #666;
      margin-bottom: 24px;
    }

    .share-box {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 4px 16px var(--shadow);
      margin-bottom: 32px;
    }

    .share-link {
      background: var(--cream);
      padding: 16px;
      border-radius: 8px;
      font-family: monospace;
      word-break: break-all;
      margin: 16px 0;
      border: 2px solid var(--sand);
      font-size: 0.75rem;
      max-height: 120px;
      overflow-y: auto;
    }

    .copy-btn {
      background: var(--sage);
    }

    .copy-btn:hover {
      background: #6a8a66;
    }

    .success-message {
      color: var(--sage);
      font-weight: 600;
      margin-top: 8px;
      animation: fadeIn 0.3s;
    }

    .helper-text {
      font-size: 0.875rem;
      color: #888;
      margin-top: 8px;
    }

    .bulk-input-label {
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
      color: var(--charcoal);
    }

    .info-box {
      background: #e7f3ff;
      border: 2px solid #2196F3;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
      color: #0d47a1;
      line-height: 1.6;
    }

    @media (max-width: 640px) {
      h1 { font-size: 2.5rem; }
      .matchup-cards { grid-template-columns: 1fr; gap: 16px; }
      .matchup-card { padding: 32px 24px; }
      .ranking-number { font-size: 1.5rem; min-width: 50px; }
      .ranking-name { font-size: 1.125rem; }
      .actions { flex-direction: column; }
      button { width: 100%; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function RankingApp() {
      const [mode, setMode] = useState('home'); // home, create, vote, results
      const [phase, setPhase] = useState('intro'); // intro, matchup, results
      const [items, setItems] = useState([]);
      const [inputValue, setInputValue] = useState('');
      const [bulkInput, setBulkInput] = useState('');
      const [voterName, setVoterName] = useState('');
      const [currentMatchup, setCurrentMatchup] = useState(null);
      const [matchupIndex, setMatchupIndex] = useState(0);
      const [ratings, setRatings] = useState({});
      const [matchups, setMatchups] = useState([]);
      const [copied, setCopied] = useState(false);
      const [pollTitle, setPollTitle] = useState('');
      const [shareableLink, setShareableLink] = useState('');
      const [matchupPercentage, setMatchupPercentage] = useState(100);

      // Check URL for poll data on load
      useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        const pollData = params.get('d');
        if (pollData) {
          try {
            const decoded = JSON.parse(atob(pollData));
            setItems(decoded.items);
            setPollTitle(decoded.title || 'Ranking Poll');
            setMode('vote');
            setPhase('intro');
          } catch (error) {
            console.error('Invalid poll data');
          }
        }
      }, []);

      const generateMatchups = (itemsList, percentage) => {
        const allPairs = [];
        for (let i = 0; i < itemsList.length; i++) {
          for (let j = i + 1; j < itemsList.length; j++) {
            allPairs.push([itemsList[i], itemsList[j]]);
          }
        }
        
        // Shuffle all pairs
        const shuffled = allPairs.sort(() => Math.random() - 0.5);
        
        if (percentage === 100) {
          return shuffled;
        }
        
        // Use selected percentage of matchups (minimum 10, maximum 200)
        const targetMatchups = Math.max(10, Math.min(200, Math.floor(allPairs.length * (percentage / 100))));
        return shuffled.slice(0, targetMatchups);
      };

      const addItem = () => {
        if (inputValue.trim() && !items.includes(inputValue.trim())) {
          setItems([...items, inputValue.trim()]);
          setInputValue('');
        }
      };

      const processBulkInput = () => {
        const lines = bulkInput.split('\n')
          .map(line => line.trim())
          .filter(line => line.length > 0);
        
        const uniqueItems = [...new Set([...items, ...lines])];
        setItems(uniqueItems);
        setBulkInput('');
      };

      const removeItem = (item) => {
        setItems(items.filter(i => i !== item));
      };

      const createPoll = () => {
        if (items.length < 2 || !pollTitle.trim()) return;
        
        const pollData = {
          items,
          title: pollTitle
        };

        // Encode poll data in URL
        const encoded = btoa(JSON.stringify(pollData));
        const baseUrl = window.location.href.split('?')[0];
        const link = `${baseUrl}?d=${encoded}`;
        
        setShareableLink(link);
        setMode('created');
      };

      const startVoting = () => {
        if (!voterName.trim()) {
          alert('Please enter your name');
          return;
        }

        const initialRatings = {};
        items.forEach(item => {
          initialRatings[item] = 1500;
        });
        setRatings(initialRatings);

        const pairs = generateMatchups(items, matchupPercentage);
        setMatchups(pairs);
        setCurrentMatchup(pairs[0]);
        setMatchupIndex(0);
        setPhase('matchup');
      };

      const calculateElo = (winnerRating, loserRating, k = 32) => {
        const expectedWinner = 1 / (1 + Math.pow(10, (loserRating - winnerRating) / 400));
        const expectedLoser = 1 / (1 + Math.pow(10, (winnerRating - loserRating) / 400));
        
        const newWinnerRating = winnerRating + k * (1 - expectedWinner);
        const newLoserRating = loserRating + k * (0 - expectedLoser);
        
        return { newWinnerRating, newLoserRating };
      };

      const selectWinner = (winner) => {
        const loser = currentMatchup.find(item => item !== winner);
        
        const { newWinnerRating, newLoserRating } = calculateElo(
          ratings[winner],
          ratings[loser]
        );

        const newRatings = {
          ...ratings,
          [winner]: newWinnerRating,
          [loser]: newLoserRating
        };
        setRatings(newRatings);

        if (matchupIndex < matchups.length - 1) {
          setMatchupIndex(matchupIndex + 1);
          setCurrentMatchup(matchups[matchupIndex + 1]);
        } else {
          setPhase('results');
        }
      };

      const getRankedItems = () => {
        return items
          .map(item => ({ name: item, rating: Math.round(ratings[item] || 1500) }))
          .sort((a, b) => b.rating - a.rating);
      };

      const copyLink = () => {
        navigator.clipboard.writeText(shareableLink);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      };

      const resetToHome = () => {
        setMode('home');
        setPhase('intro');
        setItems([]);
        setInputValue('');
        setBulkInput('');
        setVoterName('');
        setCurrentMatchup(null);
        setMatchupIndex(0);
        setRatings({});
        setMatchups([]);
        setPollTitle('');
        setShareableLink('');
        setCopied(false);
        setMatchupPercentage(100);
        window.history.pushState({}, '', window.location.pathname);
      };

      const voteAgain = () => {
        setVoterName('');
        setCurrentMatchup(null);
        setMatchupIndex(0);
        setRatings({});
        setMatchups([]);
        setMatchupPercentage(100);
        setPhase('intro');
      };

      return (
        <div className="container">
          {mode === 'home' && (
            <div>
              <h1>Head-to-Head Rankings</h1>
              <p className="subtitle">Create polls and share with friends to rank items</p>
              
              <div className="actions">
                <button onClick={() => setMode('create')}>Create New Poll</button>
              </div>
            </div>
          )}

          {mode === 'create' && (
            <div>
              <span className="phase-indicator">Create Poll</span>
              <h1>Set Up Your Poll</h1>
              <p className="subtitle">Add items for people to rank</p>

              <div className="input-group">
                <label className="bulk-input-label">Poll Title</label>
                <input
                  type="text"
                  value={pollTitle}
                  onChange={(e) => setPollTitle(e.target.value)}
                  placeholder="e.g., Best Movies of 2024"
                />
              </div>

              <div className="input-group">
                <label className="bulk-input-label">Add Items (one at a time)</label>
                <div className="input-wrapper">
                  <input
                    type="text"
                    value={inputValue}
                    onChange={(e) => setInputValue(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && addItem()}
                    placeholder="Enter an item..."
                  />
                  <button onClick={addItem}>Add</button>
                </div>
              </div>

              <div className="input-group">
                <label className="bulk-input-label">Or Paste Multiple Items (one per line)</label>
                <textarea
                  value={bulkInput}
                  onChange={(e) => setBulkInput(e.target.value)}
                  placeholder={"The Shawshank Redemption\nThe Godfather\nThe Dark Knight\nPulp Fiction"}
                />
                <p className="helper-text">Paste a list with one item per line</p>
                <button className="secondary" onClick={processBulkInput} style={{marginTop: '12px'}}>
                  Add All Items
                </button>
              </div>

              {items.length > 0 && (
                <div>
                  <div className="items-list">
                    {items.map((item, index) => (
                      <div key={index} className="item-chip" style={{ animationDelay: `${index * 0.05}s` }}>
                        {item}
                        <button className="remove-btn" onClick={() => removeItem(item)}>√ó</button>
                      </div>
                    ))}
                  </div>

                  <div className="actions">
                    <button onClick={createPoll} disabled={items.length < 2 || !pollTitle.trim()}>
                      Create Poll ({items.length} items)
                    </button>
                    <button className="secondary" onClick={resetToHome}>Cancel</button>
                  </div>
                </div>
              )}
            </div>
          )}

          {mode === 'created' && (
            <div>
              <span className="phase-indicator">Poll Created!</span>
              <h1>Share Your Poll</h1>
              <p className="subtitle">Send this link to friends so they can rank the items</p>

              <div className="share-box">
                <h3 style={{marginBottom: '12px', fontFamily: 'Fraunces', fontSize: '1.5rem'}}>
                  üì§ Share This Link
                </h3>
                <div className="share-link">
                  {shareableLink}
                </div>
                <button className="copy-btn" onClick={copyLink}>
                  {copied ? '‚úì Copied!' : 'Copy Link'}
                </button>
                {copied && <p className="success-message">Link copied! Share it with your friends.</p>}
              </div>

              <div className="info-box">
                üí° <strong>How it works:</strong> Each person who opens the link will go through all the matchups and get their own personal rankings at the end!
              </div>

              <div className="actions">
                <button onClick={() => { setMode('vote'); setPhase('intro'); }}>
                  Try It Yourself
                </button>
                <button className="secondary" onClick={resetToHome}>Create Another Poll</button>
              </div>
            </div>
          )}

          {mode === 'vote' && phase === 'intro' && (
            <div>
              <span className="phase-indicator">Ready to Rank</span>
              <h1>{pollTitle}</h1>
              <p className="subtitle">You'll rank {items.length} items through head-to-head matchups</p>

              <div className="input-group">
                <label className="bulk-input-label">Your Name</label>
                <input
                  type="text"
                  value={voterName}
                  onChange={(e) => setVoterName(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && startVoting()}
                  placeholder="Enter your name..."
                />
              </div>

              <div className="input-group">
                <label className="bulk-input-label">Number of Matchups</label>
                <div style={{display: 'flex', gap: '16px', flexWrap: 'wrap'}}>
                  <label style={{display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer'}}>
                    <input
                      type="radio"
                      name="percentage"
                      value={100}
                      checked={matchupPercentage === 100}
                      onChange={(e) => setMatchupPercentage(Number(e.target.value))}
                      style={{cursor: 'pointer'}}
                    />
                    <span>All ({Math.floor(items.length * (items.length - 1) / 2)} matchups)</span>
                  </label>
                  <label style={{display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer'}}>
                    <input
                      type="radio"
                      name="percentage"
                      value={50}
                      checked={matchupPercentage === 50}
                      onChange={(e) => setMatchupPercentage(Number(e.target.value))}
                      style={{cursor: 'pointer'}}
                    />
                    <span>Half (~{Math.floor(items.length * (items.length - 1) / 4)} matchups)</span>
                  </label>
                  <label style={{display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer'}}>
                    <input
                      type="radio"
                      name="percentage"
                      value={25}
                      checked={matchupPercentage === 25}
                      onChange={(e) => setMatchupPercentage(Number(e.target.value))}
                      style={{cursor: 'pointer'}}
                    />
                    <span>Quarter (~{Math.floor(items.length * (items.length - 1) / 8)} matchups)</span>
                  </label>
                </div>
                <p className="helper-text">Fewer matchups = faster, but less precise rankings</p>
              </div>

              <div className="actions">
                <button onClick={startVoting} disabled={!voterName.trim()}>
                  Start Ranking
                </button>
              </div>
            </div>
          )}

          {mode === 'vote' && phase === 'matchup' && currentMatchup && (
            <div className="matchup-container">
              <span className="phase-indicator">{voterName}'s Rankings</span>
              <h1>Which do you prefer?</h1>
              <p className="subtitle">Click your favorite</p>

              <div className="progress-bar">
                <div 
                  className="progress-fill" 
                  style={{ width: `${((matchupIndex + 1) / matchups.length) * 100}%` }}
                />
              </div>

              <div className="stats">
                Matchup {matchupIndex + 1} of {matchups.length}
              </div>

              <div className="matchup-cards">
                <div className="matchup-card" onClick={() => selectWinner(currentMatchup[0])}>
                  <h3>{currentMatchup[0]}</h3>
                </div>
                <div className="matchup-card" onClick={() => selectWinner(currentMatchup[1])}>
                  <h3>{currentMatchup[1]}</h3>
                </div>
              </div>
            </div>
          )}

          {mode === 'vote' && phase === 'results' && (
            <div>
              <span className="phase-indicator">{voterName}'s Results</span>
              <h1>Your Rankings</h1>
              <p className="subtitle">Here's how you ranked the {items.length} items</p>

              <div className="rankings-list">
                {getRankedItems().map((item, index) => (
                  <div 
                    key={item.name} 
                    className="ranking-item"
                    style={{ animationDelay: `${index * 0.1}s` }}
                  >
                    <div className="ranking-number">
                      #{index + 1}
                      {index === 0 && <span className="trophy">üèÜ</span>}
                    </div>
                    <div className="ranking-name">{item.name}</div>
                    <div className="ranking-score">{item.rating}</div>
                  </div>
                ))}
              </div>

              <div className="actions">
                <button onClick={voteAgain}>Vote Again</button>
                <button className="secondary" onClick={resetToHome}>Done</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<RankingApp />, document.getElementById('root'));
  </script>
</body>
</html>
